<?php $pageTitle = "Reserve Worker"; $pgNum = "2.2.0"; $pgType = "page"; include('../inc/header.inc.php'); ?>
	
			<!-- Left Hand Content Area -->
		<!--  LH box not used on this page
			<div class="col-left">
		-->
				<!-- LH box module -->
		<!--  LH box not used on this page
				<?php include('../inc/location.inc.php'); ?>
			</div>
		-->
			
		<!-- not used on this page -->	<!-- Right Hand Content Area -->
<div>   <!-- class="col-right" -->
    <br />
	<h2 class="h2center">Reserve Worker</h2>
	
	<br />
    <p>When you need help with a big project or with routine work around your home,
	    you are welcome to simply come to the center on the day of your job and 
		a friendly staff member will help you and have you on your way in minutes.
	   To help us connect you with a worker with the desired skills, fill out the below form.
	   We are open from 7am to 5pm, Monday to Saturday, but note that there are fewer workers available 
	    later in the day.
	   (Note: if you have an ongoing project and have found that one of our workers is providing a 
	     valuable service, simply arrange with that worker to continue on consecutive days.)</p>
	<br />
	
	<?php
	//error_reporting(E_ALL | E_STRICT);
	//define("DEBUG_HAW", FALSE);
	
	include("../php_includes/util.php");
	
	$displayForm = TRUE;
	$firstField = "employerName";
	$focusField = "";
	
	$employerName = "";
	$companyName = "";
	$address = "";
	$city = "";
	$addressCrossStreet = "";
	$email = "";
	$phone = "";
	$hearAboutDWC = "";
	$startDay = "";
	$startTime = "";
	
	define("START_TIME_AM", "am");
	define("START_TIME_PM", "pm");
	$startTimeAmPmChoices = array();
	$startTimeAmPmChoices[START_TIME_AM] = START_TIME_AM;
	$startTimeAmPmChoices[START_TIME_PM] = START_TIME_PM;
	$startTimeAmPm = "";
	
	$workHours = "";
	$jobSkills = "";
	$payRate = "";
	
	define("WILL_PROVIDE_LUNCH", "Will provide lunch");
	define("RESTROOM_AVAILABLE", "Restroom available");
	define("WILL_BRING_BACK_TO_DWC", "Will bring back to DWC");
	define("WILL_PAY_COMMUTE_TIME", "Will pay commute time");
	define("WILL_PAY_CASH", "Will pay cash");
	$infoChoices = array();
	$infoChoices[WILL_PROVIDE_LUNCH] = WILL_PROVIDE_LUNCH;
	$infoChoices[RESTROOM_AVAILABLE] = RESTROOM_AVAILABLE;
	$infoChoices[WILL_BRING_BACK_TO_DWC] = WILL_BRING_BACK_TO_DWC;
	$infoChoices[WILL_PAY_COMMUTE_TIME] = WILL_PAY_COMMUTE_TIME;
	$infoChoices[WILL_PAY_CASH] = WILL_PAY_CASH;
	$info = array();
	
	define("ENGLISH_NONE", "None");
	define("ENGLISH_UNDERSTAND_ONLY", "Understand only");
	define("ENGLISH_UNDERSTAND_AND_SPEAK", "Understand and speak");
	define("ENGLISH_UNDERSTAND_AND_SPEAK_WELL", "Understand and speak well");
	$englishLevelChoices = array();
	$englishLevelChoices[ENGLISH_NONE] = ENGLISH_NONE;
	$englishLevelChoices[ENGLISH_UNDERSTAND_ONLY] = ENGLISH_UNDERSTAND_ONLY;
	$englishLevelChoices[ENGLISH_UNDERSTAND_AND_SPEAK] = ENGLISH_UNDERSTAND_AND_SPEAK;
	$englishLevelChoices[ENGLISH_UNDERSTAND_AND_SPEAK_WELL] = ENGLISH_UNDERSTAND_AND_SPEAK_WELL;
	$englishLevel = "";
	
	if (isset($_POST["cSubmit"])) {
		// edit form
		$errorCount = 0;
		define("FIELD_REQUIRED_YES", TRUE);
		define("FIELD_REQUIRED_NO",  FALSE);
		
		$employerName = validateField($_POST['employerName'], "Name", "employerName", 
		                              FIELD_REQUIRED_YES);
		$companyName = validateField($_POST['companyName'], "Company", "companyName", 
		                             FIELD_REQUIRED_NO);
		$address  = validateField($_POST['address'], "Address", "address", FIELD_REQUIRED_YES);
		$city  = validateField($_POST['city'], "City", "city", FIELD_REQUIRED_YES);
		$addressCrossStreet  = validateField($_POST['addressCrossStreet'], "Cross street", 
	                                         "addressCrossStreet", FIELD_REQUIRED_NO);
		$phone = validateField($_POST['phone'], "Phone", "phone", FIELD_REQUIRED_YES);
		if ((string)$phone !== "")
		    validatePhone($phone, "Phone", "phone");
		$email = validateField($_POST['email'], "E-mail Address", "email", FIELD_REQUIRED_NO);
		if ((string)$email !== "")
		    validateEmail($email, "E-mail Address", "email");
		$hearAboutDWC  = validateField($_POST['hearAboutDWC'], "How did you hear about us", 
	                                   "hearAboutDWC", FIELD_REQUIRED_NO);
		
		$startDay  = validateField($_POST['startDay'], "Start Day", "startDay", FIELD_REQUIRED_YES);
		if ((string)$startDay !== "")
		    validateDate($startDay, "Start Day", "startDay");
		$startTime  = validateField($_POST['startTime'], "Start Time", "startTime", FIELD_REQUIRED_YES);
		if ((string)$startTime !== "")
		    validateTime($startTime, "Start Time", "startTime");
		$startTimeAmPm  = validateField($_POST['startTimeAmPm'], "Start Time am/pm", 
		                                "startTime", FIELD_REQUIRED_YES);
		$workHours  = validateField($_POST['workHours'], "Work Hours", "workHours", FIELD_REQUIRED_YES);
		if ((string)$workHours !== "")
		    validatePositiveInt($workHours, "Work Hours", "workHours");
		$jobSkills  = validateField($_POST['jobSkills'], "Job skills", "jobSkills", FIELD_REQUIRED_YES);
		$payRate  = validateField($_POST['payRate'], "Pay rate", "payRate", FIELD_REQUIRED_NO);
		if ((string)$payRate !== "")
		    validateMoney($payRate, "Pay rate", "payRate");
		$info = $_POST['info'];   // not validated since check box & not required
		$englishLevel  = validateField($_POST['englishLevel'], "English level needed", 
		                               "", FIELD_REQUIRED_YES);
		
		if ($errorCount > 0)
		    $displayForm = TRUE;
		else {
			// check error_reporting() above
			$to_address = "Maria Marroquin <maria@dayworkercentermv.org>" . ", "
			    . "Robin <robin@dayworkercentermv.org>" . ", "
				. "Ana Cruz-Barajas <ana@dayworkercentermv.org>";
			
			$subject = "Reserve Worker from " . $employerName . " via DWC website";
			
			$cDetails = "RESERVE WORKER from Day Worker Center website" . PHP_EOL
			    . PHP_EOL 
				. "EMPLOYER: " . PHP_EOL 
				. "Name: " . $employerName . PHP_EOL 
				. "Company: " . $companyName . PHP_EOL 
				. "Address: " . $address . "          City: " . $city . PHP_EOL
				. "Cross street: " . $addressCrossStreet. PHP_EOL 
				. "Phone: " . $phone . "          Email: " . $email . PHP_EOL 
				. "How did you hear about us? " . $hearAboutDWC . PHP_EOL; 
			
			$payRate = trim($payRate);
			if (substr($payRate,0,1) !== "$")
			    $payRate = "$" . $payRate;
			$cDetails .= PHP_EOL 
			    . "JOB DESCRIPTION: ". PHP_EOL 
				. "Start day: " . $startDay 
				. "     Start time: " . $startTime . $startTimeAmPm 
				. "          Work Hours: " . $workHours . PHP_EOL 
				. "Job skills: " . $jobSkills . PHP_EOL 
				. "Pay rate: " . $payRate . PHP_EOL 
				. "Check all that apply: " . PHP_EOL;
			if (!empty($info)) {
				foreach ($infoChoices as $infoChoice) {
					if (in_array($infoChoice, $info))
					    $cDetails .= " _x_ " . $infoChoice . PHP_EOL;
					else
					    $cDetails .= " ___ " . $infoChoice . PHP_EOL;
				}
			}
			$cDetails .= "English level needed: " . $englishLevel . PHP_EOL;
			
			$cDetails .= PHP_EOL
			    . "__________________________________________________________________________" . PHP_EOL
				. "For office use:           Worker name(s)" . PHP_EOL;
			
			$headers = "Reply-To: " . $employerName . " <" . $email . '>' . PHP_EOL;
			$headers .= "Content-type: text/plain" . PHP_EOL;
			
			$result = mail($to_address, $subject, $cDetails, $headers);
			if ($result) {
				print '<br />';
				print '<table width="360" cellpadding=3 cellspacing=0 border=0>';
				print '  <tr>
				           <td></td>
					       <td class="pageCopySmall_noMargin">
					         <div align="center">
						       Thank you for completing the form to reserve a worker.<br /><br />
							   An email with your info has been sent to our staff. 
							   We will contact you shortly.</div></td>
					       <td></td>
					      </tr>
					    </table>';
			}
			else
			    echo "There was a problem sending your email.<br />\n";
			
			// clear $_POST so that the form is not sticky
			$_POST = array();
			$displayForm = FALSE;
		}
	}
	
	if ($displayForm) {
		//include("../../php_includes/autoglobalsDump.php");
		if ($focusField === "")
		    $focusField = $firstField;
	?>
	    <div id="errorMsgArea"> </div>
		
		<p>Please fill out this form to reserve a worker. &nbsp;&nbsp;(* indicate required fields)</p>

		<form id="cReserve" name="cReserve" action="<?php echo $_SERVER['SCRIPT_NAME']; ?>"
		      method="post" class="form">
		    <fieldset>
		        <h3>Employer:</h3>
				<div>
					<label for="employerName">* Name:</label>
					<div class="iefix">
						<input type="text" id="employerName" name="employerName" class="type_text" 
						       value="<?php echo $employerName; ?>" />
					</div>
				</div>
				<div>
					<label for="companyName">Company (if applicable):</label>
					<div class="iefix">
						<input type="text" id="companyName" name="companyName" class="type_text" 
						       value="<?php echo $companyName; ?>" />
					</div>
				</div>
				<div class="labelFF">
					<label for="phone">* Address:</label>
					<div class="labelFF iefix">
						<input type="text" id="address" name="address" class="type_text"
						       value="<?php echo $address; ?>" />
						<label for="city" class="labelFF">* City:</label>
						<input type="text" id="city" name="city" class="type_textFF" size="36" 
						       value="<?php echo $city; ?>" />
					</div>
				</div>
				<div>
					<label for="addressCrossStreet">Cross street:</label>
					<div class="iefix">
						<input type="text" id="addressCrossStreet" name="addressCrossStreet" 
						       class="type_textFF" size="75"
							   value="<?php echo $addressCrossStreet; ?>" />
					</div>
				</div>
				<div class="labelFF">
					<label for="phone">* Phone:</label>
					<div class="labelFF iefix">
						<input type="text" id="phone" name="phone" class="type_textFF" 
						       value="<?php echo $phone; ?>" />
						<label for="email" class="labelFF">E-mail Address:</label>
						<input type="text" id="email" name="email" class="type_text" 
						       value="<?php echo $email; ?>" />
					</div>
				</div>
				<div>
					<label for="hearAboutDWC">How did you hear about us?</label>
					<div class="iefix">
						<input type="text" id="hearAboutDWC" name="hearAboutDWC" 
						       class="type_textFF" size="75" 
							   value="<?php echo $hearAboutDWC; ?>" />
					</div>
				</div>
			</fieldset>
			
			<br />
			<fieldset>
				<h3>Job Description:</h3>
				<div class="labelFF">
					<label for="startDay">* Start Day (mm/dd/yyyy):</label>
					<div class="labelFF iefix">
						<input type="text" id="startDay" name="startDay" class="type_textFF" 
						       value="<?php echo $startDay; ?>" />
						<label for="startTime" class="labelFF">* Start Time:</label>
						<input type="text" id="startTime" name="startTime" class="type_textFF" size="10" 
						       value="<?php echo $startTime; ?>" />
					<?php
						echo '<input type="radio" id="startTimeAmPm" name="startTimeAmPm" class="radio" ';
						    if ($startTimeAmPm == START_TIME_AM) echo " checked='checked'";
						    echo    'value="' . $startTimeAmPmChoices[START_TIME_AM] . '" />';
						    echo    $startTimeAmPmChoices[START_TIME_AM];
						echo '<input type="radio" id="startTimeAmPm" name="startTimeAmPm" class="radio" ';
						    if ($startTimeAmPm == START_TIME_PM) echo " checked='checked'";
						    echo    'value="' . $startTimeAmPmChoices[START_TIME_PM] . '" />';
						    echo    $startTimeAmPmChoices[START_TIME_PM];
					?>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						<label for="workHours" class="labelFF">* Work Hours:</label>
						<input type="text" id="workHours" name="workHours" class="type_textFF" size="10" 
						       value="<?php echo $workHours; ?>" />
					</div>
				</div>
				<div>
					<label for="jobSkills">* Job skills:</label>
					<div class="iefix">		
						<input type="text" id="jobSkills" name="jobSkills" class="type_textFF" size="75" 
						       value="<?php echo $jobSkills; ?>" />
					</div>
				</div>
				<div>
					<label for="payRate">Pay rate:</label>
					<div class="iefix">
						<input type="text" id="payRate" name="payRate" class="type_textFF" 
						       value="<?php echo $payRate; ?>" />
					</div>
				</div>
				<div class="labelFF">
					<label for="info">Check all that apply:</label>
					<div class="iefix">
					<?php
					    $infoIntersect = array_intersect($info, $infoChoices);
						echo '<input type="checkbox" id="info" name="info[]" class="checkbox" ';
						    if (in_array(WILL_PROVIDE_LUNCH, $infoIntersect)) echo " checked='checked'";
						    echo    'value="' . $infoChoices[WILL_PROVIDE_LUNCH] . '" />';
						    echo    $infoChoices[WILL_PROVIDE_LUNCH] . "<br />";
						echo '<input type="checkbox" id="info" name="info[]" class="checkbox" ';
						    if (in_array(RESTROOM_AVAILABLE, $infoIntersect)) echo " checked='checked'";
						    echo    'value="' . $infoChoices[RESTROOM_AVAILABLE] . '" />';
						    echo    $infoChoices[RESTROOM_AVAILABLE] . "<br />";
						echo '<input type="checkbox" id="info" name="info[]" class="checkbox" ';
						    if (in_array(WILL_BRING_BACK_TO_DWC, $infoIntersect)) echo " checked='checked'";
						    echo    'value="' . $infoChoices[WILL_BRING_BACK_TO_DWC] . '" />';
						    echo    $infoChoices[WILL_BRING_BACK_TO_DWC] . "<br />";
						echo '<input type="checkbox" id="info" name="info[]" class="checkbox" ';
						    if (in_array(WILL_PAY_COMMUTE_TIME, $infoIntersect)) echo " checked='checked'";
						    echo    'value="' . $infoChoices[WILL_PAY_COMMUTE_TIME] . '" />';
						    echo    $infoChoices[WILL_PAY_COMMUTE_TIME] . "<br />";
						echo '<input type="checkbox" id="info" name="info[]" class="checkbox" ';
						    if (in_array(WILL_PAY_CASH, $infoIntersect)) echo " checked='checked'";
						    echo    'value="' . $infoChoices[WILL_PAY_CASH] . '" />';
						    echo    $infoChoices[WILL_PAY_CASH] . "<br />";
					?>
					</div>
					<label for="englishLevel">* English level needed:</label>
					<div class="iefix">
					<?php
						echo '<input type="radio" id="englishLevel" name="englishLevel" class="radio" ';
						    if ($englishLevel == ENGLISH_NONE) echo " checked='checked'";
						    echo    'value="' . $englishLevelChoices[ENGLISH_NONE] . '" />';
						    echo    $englishLevelChoices[ENGLISH_NONE] . "<br />";
						echo '<input type="radio" id="englishLevel" name="englishLevel" class="radio" ';
						    if ($englishLevel == ENGLISH_UNDERSTAND_ONLY) echo " checked='checked'";
						    echo    'value="' . $englishLevelChoices[ENGLISH_UNDERSTAND_ONLY] . '" />';
						    echo    $englishLevelChoices[ENGLISH_UNDERSTAND_ONLY] . "<br />";
						echo '<input type="radio" id="englishLevel" name="englishLevel" class="radio" ';
						    if ($englishLevel == ENGLISH_UNDERSTAND_AND_SPEAK) echo " checked='checked'";
						    echo    'value="' . $englishLevelChoices[ENGLISH_UNDERSTAND_AND_SPEAK] . '" />';
						    echo    $englishLevelChoices[ENGLISH_UNDERSTAND_AND_SPEAK] . "<br />";
						echo '<input type="radio" id="englishLevel" name="englishLevel" class="radio" ';
						    if ($englishLevel == ENGLISH_UNDERSTAND_AND_SPEAK_WELL) echo " checked='checked'";
						    echo    'value="' . $englishLevelChoices[ENGLISH_UNDERSTAND_AND_SPEAK_WELL] . '" />';
						    echo    $englishLevelChoices[ENGLISH_UNDERSTAND_AND_SPEAK_WELL];
					?>
					</div>
				</div>
				
				<div>
					<div class="iefix">
						<input type="submit" name="cSubmit" value="Submit" />
					</div>
				</div>
			</fieldset>
		</form>
		<script type="text/javascript">
			if (document.getElementById) {
				var cReserveId = document.getElementById("cReserve");
				cReserveId.elements['<?php echo $focusField; ?>'].focus();
			}
			else {
				this.form.elements['<?php echo $focusField; ?>'].focus();
			}
		</script>
		
		<br />
		<p>If you are having trouble with this form and 
		    want to send an email directly to the Center, click 
			<a href="mailto:info@dayworkercentermv.org?Subject=Reserve%20Worker%20by%20email">here</a>.
		</p>
	<?php
    }
	 ?>
	
	<br /><br />
    <p>Visit our <a href="services.php">Services</a> page for a list of ways that our workers can help 
	    you with your projects.</p>
</div>


<?php include('../inc/footer.inc.php'); ?>
